<!DOCTYPE html>
<html>

<head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"> </script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://kit.fontawesome.com/dc2bc3f275.js" crossorigin="anonymous"></script>

</head>

<link rel="stylesheet" href="../css/style-AR.css" />


<body style="margin: 0px; overflow: hidden;">
    <div id="draggableModal" class="tab-container">
        <!-- Conteúdo do Sobre aqui -->
        <div class="header" id="header">
            <div class="tabs">
                <button class="tab-button" onclick="openTab(event, 'Tempo')">Tempo</button>
                <button class="tab-button" onclick="openTab(event, 'Definicoes')">Definições</button>
            </div>
            <div id="Tempo" class="tab-content">
                <div class="play-box">
                    <div class="button-box">
                        <button disabled id="start-animation" class="start-animation">
                            <i class="fa-solid fa-play" style="color: #ffffff;"></i>
                        </button>
                    </div>
                    <div class="time-box">
                        <div class="day-shift">
                            <button id="decrement-day">
                                <i class="fa-solid fa-chevron-right fa-flip-horizontal" style="color: #9d4b6b;"></i>
                            </button>
                            <span id="current-day" style="padding-left: 10px; padding-right: 10px; font-size: medium;">
                                Dia 0
                            </span>
                            <button id="increment-day">
                                <i class="fa-solid fa-chevron-right" style="color: #9d4b6b;"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="Definicoes" class="tab-content"></div>
        </div>

        <p>Fases da Lua</p>
        <div id="dynamic-bar" class="dynamic-bar"><span></span></div>



    </div>

    <script src="../js/app.js">
    </script>
    <script src="./gestures.js"></script>

    <a-scene class="clickable" embedded id="scene" gesture-detector
        arjs="debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3_HAMMING63;"
        vr-mode-ui="enabled: false" loading-screen="enabled:false">
        <a-assets>
            <a-asset-item id="earth" src="../assets/models/earth-3/scene.gltf"></a-asset-item>
            <a-asset-item id="moon" src="../assets/models/moon-3/scene.gltf"></a-asset-item>
            <a-asset-item id="rocket" src="../assets/models/rocket/scene.gltf"></a-asset-item>
            <a-asset-item id="mascote" src="../assets/models/joana_diss.glb"></a-asset-item>
            <img id="my-texture">
        </a-assets>

        <!-- <a-marker preset="hiro"> -->
        <!-- <a-nft type="nft" url="./pages/nft/fasesdalua" smooth="true" smoothCount="10" smoothTolerance=".01"
      smoothThreshold="5"> -->
        <a-marker marker-handler markerhandler emitevents="true" cursor="rayOrigin: mouse; fuse: true"
            id="animated-marker" type="barcode" value="1">

            <!-- Luz geral sem projeção de sombras -->
            <!-- <a-entity
                light="type: directional; color: #FFF; intensity: 0.5; castShadow: false; shadowCameraVisible: false"
                position="-40 1 0"></a-entity> -->

            <!-- Luz específica para a Terra e a Lua -->
            <a-entity light="type: directional; color: #FFF; intensity: 1; castShadow: true; shadowCameraVisible: true"
                position="-40 1 0"></a-entity>

            <a-entity position="0 0 0" scale="0.5 0.5 0.5" class="clickable">
                <a-entity position=" 0 0 0" rotation="0 0 23.5">
                    <a-gltf-model src="#earth" scale="1 1 1" rotate-continuously="speed: 84; active: false; body: earth"
                        position="0 0 0" id="earthModel" class="clickable" rotation="0 -170 0"
                        shadow="cast: true; receive: true" class="interactive">
                    </a-gltf-model>
                    <a-cylinder position=" 0 0 0" radius="0.01" height="4" color="#00000"></a-cylinder>
                </a-entity>
                <a-entity position=" 0 0 0" rotation="0 0 0" rotate-continuously="speed: 84; active: false">
                    <a-gltf-model src="#mascote" scale="0.4 0.4 0.4" position="-1 0.3 0" rotation="-90 0 90"
                        shadow="cast: false; receive: false;" id="mascote2">
                    </a-gltf-model>

                    <!-- <a-entity geometry="primitive: plane; width: 1.6; height: 0.4;" position="-1.6 3 0"
                        material="color: black; transparent: true;" look-at="#camera">
                        <a-text value="Texto sobre a Terra" color="white" align="center" width="1.5"
                            position="0 0 0.01"></a-text>
                    </a-entity> -->
                    <a-entity id="planeMoon" geometry="primitive: plane; width: 1.6; height: 0.9;" position="-1.6 1.8 0"
                        material="src: #my-texture; transparent: true;" look-at="#camera"
                        shadow="cast: false; receive: false;"></a-entity>
                </a-entity>
                <!-- moon  -->
                <a-entity rotate-continuously="speed: 3; active: false" id="moon-rotate" position="0 0 0"
                    rotation="0 0 0" gesture-handler>
                    <a-ring radius-inner="2.5" radius-outer="2.52" material="color: white;" rotation="-90 0 0"></a-ring>
                    <a-entity rotate-continuously="speed: 3; active: false" gltf-model="#moon" id="moonModel"
                        scale="0.272 0.272 0.272" position="-2.5 0 0" rotation="90 0 0" class="clickable"
                        update-panel-position gesture-handler>
                    </a-entity>
                    <a-gltf-model shadow="cast: false; receive: false;" src="#rocket" scale="0.05 0.05 0.05"
                        position="-2.7 0.5 -0.3" rotation="0 0 90">
                    </a-gltf-model>
                </a-entity>
            </a-entity>
        </a-marker>
        <a-entity id="camera" camera>
            <a-cursor></a-cursor>
        </a-entity>
    </a-scene>

    <div class="circle-back">
        <a href="./index.html">
            <img src="../assets/images/back.png" alt="back" style="width: 20px; height: 20px" />
        </a>
    </div>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const cursor = document.querySelector('a-cursor');
            cursor.addEventListener('click', function (evt) {
                if (evt.detail.intersection) {
                    console.log('Clicked at:', evt.detail.intersection.point);
                } else {
                    console.log('Clicked without intersection details');
                }
            });

            // const scene = document.querySelector('a-scene');
            // scene.addEventListener('click', function (evt) {
            //     console.log('Touch started', evt.detail.intersection.point);
            //     // Handle touch start
            // });
        });

        AFRAME.registerComponent('light-target', {
            schema: {
                targets: { type: 'selectorAll' }
            },
            init: function () {
                var light = this.el.getObject3D('light');
                if (light) {
                    light.layers.set(1);
                    this.data.targets.forEach(target => {
                        target.object3D.layers.set(1);
                    });
                }
            }
        });

        AFRAME.registerComponent('look-at', {
            schema: { type: 'selector' },

            tick: function () {
                this.el.object3D.lookAt(this.data.object3D.position)
            }
        })


        AFRAME.registerComponent("markerhandler", {
            init: function () {
                const animatedMarker = document.querySelector("#animated-marker");
                const aEntity = document.querySelector("#moonModel");
                const earthEntity = document.querySelector("#earthModel");
                const orbitEntity = document.querySelector("#moon-rotate");

                // every click, we make our model grow in size :)
                animatedMarker.addEventListener("click", function (ev, target) {

                    // const intersectedElement = ev && ev.detail && ev.detail.intersectedEl;
                    // console.log("marker clicked!", intersectedElement.point);

                    // if (earthEntity && intersectedElement === earthEntity) {
                    //   console.log("Earth was clicked at!");

                    //   const rotation = earthEntity.getAttribute("rotation");
                    //   rotation.y = rotation.y + 20;
                    //   earthEntity.setAttribute("rotation", rotation);

                    // }

                    // if (aEntity && intersectedElement === aEntity) {
                    //     console.log("Model was clicked at!");

                    //     const rotation = aEntity.getAttribute("rotation");
                    //     rotation.y = rotation.y + 20;
                    //     aEntity.setAttribute("rotation", rotation);

                    //     const rotationOrbit = orbitEntity.getAttribute("rotation");
                    //     rotationOrbit.y = rotationOrbit.y + 20;
                    //     orbitEntity.setAttribute("rotation", rotationOrbit);


                    // }
                });
            },
        });

        AFRAME.registerComponent('change-color-on-hover', {
            schema: {
                color: { default: 'red' }
            },

            init: function () {
                var data = this.data;
                var el = this.el;  // <a-box>
                var defaultColor = el.getAttribute('material').color;

                el.addEventListener('mouseenter', function () {
                    el.setAttribute('color', data.color);
                });

                el.addEventListener('mouseleave', function () {
                    el.setAttribute('color', defaultColor);
                });
            }
        });
    </script>

</body>


</html>